===========
Performance
===========

Performance tests for `tomopy cli <https://tomopycli.readthedocs.io/en/latest/>`_ and `tomocupy_stream cli <https://tomocupy_stream.readthedocs.io/en/latest/>`_ using the streaming data analysis cluster tomo 1-2 located at beamline 2-BM of the Advancd Photon source:

.. _cluster: https://anl.box.com/s/uysvb5ujnlugmd16r2f6o10fem9rjgvr
.. _disk_array: https://anl.box.com/s/zzyvv7w80ltwbtf09zrjiqiw7ak6i7ge
.. _cluster_quote: https://anl.box.com/s/j7wz6li4afoq2gs5g8feehmmz8q7whuy
.. _disk_array_quote: https://anl.box.com/s/sbft8cbt2xcpzuuvikixr82dn9jf6zog


+---------------+------------------------------------+-----------------------+-------------------+
| Computer name |                  CPU               |         GPU           |       RAM         | 
+---------------+------------------------------------+-----------------------+-------------------+
| tomo 1-2      | 2x Intel Xeon Gold 6326 2.90GHz    | 1x NVidia Tesla A100  |      1 TB         | 
+---------------+------------------------------------+-----------------------+-------------------+


+-----------+--------------+---------------+-----------------+---------------------------------+----------------------+
| Station   | Name         | Product       | Part list       |      Model                      |      Quote           |
+-----------+--------------+---------------+-----------------+---------------------------------+----------------------+
| 2-BM      | tomo 1-2     | MNJ15421064   | `cluster`_      |  Supermicro 740GP-TNRT cluster  | `cluster_quote`_     |
+-----------+--------------+---------------+-----------------+---------------------------------+----------------------+
| 2-BM      | disk array   | MNJ15508749   | `disk_array`_   |  SYS-220U-TNR Storage           | `disk_array_quote`_  |
+-----------+--------------+---------------+-----------------+---------------------------------+----------------------+

 
Tests 2022-07
=============
**Data: 2048x2048x2048,  ring removal off** 

**Tesla A100, Intel(R) Xeon(R) Gold 6326 CPU @ 2.90GHz, local ssd**

+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|    Method                           |      Time |  Command                                                                                                                                                                                              |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream lprec float16              |  7.5e+00s |  tomocupy_stream recon --file-name /local/data/tmp2048.h5 --reconstruction-type full --reconstruction-method lprec --dtype float16                                                                           |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream fourierrec float16         |  1.1e+01s |  tomocupy_stream recon --file-name /local/data/tmp2048.h5 --reconstruction-type full --reconstruction-algorithm fourierrec --dtype float16                                                                   |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream linerec float16            |  7.9e+00s |  tomocupy_stream recon --file-name /local/data/tmp2048.h5 --reconstruction-type full --reconstruction-method linerec --dtype float16                                                                         |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream lprec float32              |  8.5e+00s |  tomocupy_stream recon --file-name /local/data/tmp2048.h5 --reconstruction-type full --reconstruction-method lprec                                                                                           |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream fourierrec float32         |  1.5e+01s |  tomocupy_stream recon --file-name /local/data/tmp2048.h5 --reconstruction-type full --reconstruction-algorithm fourierrec                                                                                   |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream linerec float32            |  8.3e+01s |  tomocupy_stream recon --file-name /local/data/tmp2048.h5 --reconstruction-type full --reconstruction-algorithm linerec                                                                                      |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomopy                              |  1.5e+02s |  tomopy recon --file-name /local/data/tmp2048.h5 --reconstruction-type full --rotation-axis-auto manual --gridrec-padding True                                                                        |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+



**Data: 1500x2048x2448,  ring removal off** 

**Tesla A100, Intel(R) Xeon(R) Gold 6326 CPU @ 2.90GHz, local ssd**

+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|    Method                           |      Time |  Command                                                                                                                                                                                              |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomopy                              |     124s  |  tomopy recon --file-name /local/data/2021-10/Cooley/285_1_SPFP_072.h5 --reconstruction-type full  --rotation-axis 1108 --rotation-axis-auto manual --gridrec-padding True                            |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream lprec float16 (crop)       |     6.1s  |  tomocupy_stream recon --file-name /local/data/2021-10/Cooley/285_1_SPFP_072.h5 --rotation-axis 1108 --reconstruction-type full --reconstruction-method lprec                                                |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream fourierrec float16 (crop)  |     8.2s  |  tomocupy_stream recon --file-name /local/data/2021-10/Cooley/285_1_SPFP_072.h5 --rotation-axis 1108 --reconstruction-type full --reconstruction-method fourierec                                            |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream lprec float32              |     8.2s  |  tomocupy_stream recon --file-name /local/data/2021-10/Cooley/285_1_SPFP_072.h5 --rotation-axis 1108 --reconstruction-type full --reconstruction-method lprec                                                |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream fourierrec float32         |     16.0s |  tomocupy_stream recon --file-name /local/data/2021-10/Cooley/285_1_SPFP_072.h5 --rotation-axis 1108 --reconstruction-type full --reconstruction-method fourierec                                            |
+-------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+



Tests 2022-04
=============
**Data: 1500x2048x2448,  ring removal on**

+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|    Method     |      Time      |  Command                                                                                                                                                                                                   |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomopy        |     4m3.914s   |  tomopy recon --file-name /data/2021-10/Cooley/285_1_SPFP_072.h5 --reconstruction-type full  --rotation-axis 1108 --rotation-axis-auto manual --gridrec-padding True --remove-stripe-method fw             |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream 1GPU |     1m0.590s   |  tomocupy_stream recon --file-name /data/2021-10/Cooley/285_1_SPFP_072.h5 --rotation-axis 1108 --reconstruction-type full --remove-stripe-method fw                                                               |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream 2GPU |     0m41.264s  |  tomocupy_stream reconmulti --file-name /data/2021-10/Cooley/285_1_SPFP_072.h5 --rotation-axis 1108 --reconstruction-type full --remove-stripe-method fw                                                          |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

**Data: 1500x2048x2448,  ring removal off**

+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|    Method     |      Time      |  Command                                                                                                                                                                                                   |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomopy        |     2m1.059s   |  tomopy recon --file-name /data/2021-10/Cooley/285_1_SPFP_072.h5 --reconstruction-type full  --rotation-axis 1108 --rotation-axis-auto manual --gridrec-padding True                                       |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream 1GPU |     0m33.753s  |  tomocupy_stream recon --file-name /data/2021-10/Cooley/285_1_SPFP_072.h5 --rotation-axis 1108 --reconstruction-type full                                                                                         |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream 2GPU |     0m25.653s  |  tomocupy_stream reconmulti --file-name /data/2021-10/Cooley/285_1_SPFP_072.h5 --rotation-axis 1108 --reconstruction-type full                                                                                    |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


**Data: 3000x2048x2448, double fov, ring removal on**

+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|    Method     |      Time      |  Command                                                                                                                                                                                                                     |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomopy        |   10m48.947s   |  tomopy recon --file-name /data/2021-10/Cooley/Dogfish_1B_redo_106.h5 --reconstruction-type full  --rotation-axis 100 - --file-type double_fov --rotation-axis-auto manual --gridrec-padding True --remove-stripe-method fw  |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream 1GPU |     2m33.330s  |  tomocupy_stream recon --file-name /data/2021-10/Cooley/Dogfish_1B_redo_106.h5 --reconstruction-type full  --rotation-axis 100 - --file-type double_fov --remove-stripe-method fw                                                   |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream 2GPU |     1m30.010s  |  tomocupy_stream reconmulti --file-name /data/2021-10/Cooley/Dogfish_1B_redo_106.h5 --reconstruction-type full  --rotation-axis 100 - --file-type double_fov --remove-stripe-method fw                                              |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

**Data: 3000x2048x2448, double fov, ring removal off**

+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|    Method     |      Time      |  Command                                                                                                                                                                                                                     |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomopy        |   7m58.321s    |  tomopy recon --file-name /data/2021-10/Cooley/Dogfish_1B_redo_106.h5 --reconstruction-type full  --rotation-axis 100 - --file-type double_fov --rotation-axis-auto manual --gridrec-padding True                            |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream 1GPU |     1m56.257s  |  tomocupy_stream recon --file-name /data/2021-10/Cooley/Dogfish_1B_redo_106.h5 --reconstruction-type full  --rotation-axis 100 - --file-type double_fov                                                                             |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| tomocupy_stream 2GPU |     1m12.932s  |  tomocupy_stream reconmulti --file-name /data/2021-10/Cooley/Dogfish_1B_redo_106.h5 --reconstruction-type full  --rotation-axis 100 - --file-type double_fov                                                                        |
+---------------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

